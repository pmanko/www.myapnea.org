<div class="page-header">
  <h1><%= current_user.full_name %>'s Dashboard</h1>
</div>

<div class="row">
  <div class="col-md-8">
    <h2>Questionnaires</h2>
    <div id="questionnaires" class="list-group">
      <% QuestionFlow.where(status: "show").each do |qf| %>
        <a href="<%= start_answer_session_path(question_flow_id: qf.id) %>" class="list-group-item">
          <h3><%= qf.name %></h3>
          <% if AnswerSession.where(question_flow_id: qf.id, user_id: current_user.id).order(updated_at: :desc).length > 0 and (AnswerSession.where(question_flow_id: qf.id, user_id: current_user.id).order(updated_at: :desc).first.completed_answers.length == qf.all_questions.length) %>
            <p><strong>Questionnaire finished!</strong></p>
          <% elsif AnswerSession.where(question_flow_id: qf.id, user_id: current_user.id).length > 0 %>
            <%= render partial: 'answer_sessions/session_progress', locals: {answer_session: AnswerSession.where(question_flow_id: qf.id, user_id: current_user.id).order(updated_at: :desc).first} %>
          <% else %>
            <p>Questionnaire not yet started.</p>
            <p><strong>Estimated time commitment:</strong> <%= qf.total_time.round %> minutes for <%= qf.all_questions.length %> questions.</p>

          <% end %>

        </a>
      <% end %>
    </div>
  </div>

  <div class="col-md-4">
    <h2>My Profile</h2>
    <div class="btn-group-vertical">
      <%= link_to "Change Email", "", class: 'btn btn-link' %>
      <%= link_to "Change Password", "", class: 'btn btn-link' %>
    </div>
  </div>
</div>
